<!DOCTYPE HTML>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Escape Room - Registro</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <link rel="stylesheet" th:href="@{/css/main.css}"/>

    <style>
        body { font-family: 'Montserrat', sans-serif; }
        .title-font { font-family: 'Rajdhani', sans-serif; }
    </style>
</head>

<body class="pt-12 flex flex-col items-center justify-center text-white p-4 min-h-screen relative overflow-x-hidden"
      style="
          background: linear-gradient(135deg, #2c0d5a 0%, #1a0b3d 30%, #0d1a4f 100%);
          background-attachment: fixed;
      ">

<div class="fixed inset-0 z-0 pointer-events-none"
     style=" background-image:
                radial-gradient(circle at 20% 50%, rgba(255, 235, 59, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(138, 43, 226, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(30, 144, 255, 0.1) 0%, transparent 50%); ">
</div>


<header class="w-full fixed top-0 left-0 z-10 py-8" style="background-color: #1a1a3b;">
    <div class="container-fluid flex justify-between items-center px-4">
        <div>
            <a th:href="@{/login}">
                <img class="logo-escape" style="width: 60px" alt="logo" th:src="@{/img/Logo.png}">
            </a>
        </div>
        <a class="text-4xl sm:text-5xl font-bold text-center text-yellow-300 tracking-wider hover:text-blue-800"
           style="
               font-family: 'Rajdhani', sans-serif;
               text-shadow: 0 0 10px rgba(255, 235, 59, 0.3);
           ">
            ESCAPE ROOM
        </a>
        <div class="h-6 flex gap-6 items-center">
        </div>
    </div>
</header>

<main class="w-full max-w-2xl mt-20">  <div class="p-8 rounded-2xl shadow-2xl bg-white/10 backdrop-blur-md border border-yellow-400/20">
    <h2 class="text-3xl title-font font-bold text-center text-yellow-300 mb-6">
        Crear Nueva Cuenta
    </h2>

    <form th:action="@{/registrarme}" method="post" th:object="${usuario}" class="space-y-6" id="registroForm">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label for="nombre" class="block mb-2 text-sm font-medium text-yellow-100 flex items-center">
                    Nombre
                </label>
                <input th:field="*{nombre}" type="text" id="nombre"
                       class="w-full px-4 py-3 rounded-xl bg-white/10 border border-yellow-200/30 text-white placeholder-yellow-200 focus:outline-none focus:ring-2 focus:ring-yellow-400/50 transition duration-200"
                       placeholder="Tu nombre" required>
            </div>

            <div>
                <label for="apellido" class="block mb-2 text-sm font-medium text-yellow-100 flex items-center">
                    Apellido
                </label>
                <input th:field="*{apellido}" type="text" id="apellido"
                       class="w-full px-4 py-3 rounded-xl bg-white/10 border border-yellow-200/30 text-white placeholder-yellow-200 focus:outline-none focus:ring-2 focus:ring-yellow-400/50 transition duration-200"
                       placeholder="Tu apellido" required>
            </div>
        </div>

        <div>
            <label for="nombreUsuario" class="block mb-2 text-sm font-medium text-yellow-100 flex items-center">
                Nombre de Usuario
            </label>
            <input th:field="*{nombreUsuario}" type="text" id="nombreUsuario"
                   class="w-full px-4 py-3 rounded-xl bg-white/10 border border-yellow-200/30 text-white placeholder-yellow-200 focus:outline-none focus:ring-2 focus:ring-yellow-400/50 transition duration-200"
                   placeholder="Minimo 4 caracteres" required minlength="4">
        </div>

        <div>
            <label for="email" class="block mb-2 text-sm font-medium text-yellow-100 flex items-center">
                Correo Electronico
            </label>
            <input th:field="*{email}" type="email" id="email"
                   class="w-full px-4 py-3 rounded-xl bg-white/10 border border-yellow-200/30 text-white placeholder-yellow-200 focus:outline-none focus:ring-2 focus:ring-yellow-400/50 transition duration-200"
                   placeholder="ejemplo@correo.com" required>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label for="password" class="block mb-2 text-sm font-medium text-yellow-100 flex items-center">
                    Contrasenia
                </label>
                <input th:field="*{password}" type="password" id="password"
                       class="w-full px-4 py-3 rounded-xl bg-white/10 border border-yellow-200/30 text-white placeholder-yellow-200 focus:outline-none focus:ring-2 focus:ring-yellow-400/50 transition duration-200"
                       placeholder="Minimo 8 caracteres" required minlength="8">
            </div>

            <div>
                <label for="confirmPassword" class="block mb-2 text-sm font-medium text-yellow-100 flex items-center">
                    Confirmar Contrasenia
                </label>
                <input type="password" id="confirmPassword" name="confirmPassword"
                       class="w-full px-4 py-3 rounded-xl bg-white/10 border border-yellow-200/30 text-white placeholder-yellow-200 focus:outline-none focus:ring-2 focus:ring-yellow-400/50 transition duration-200"
                       placeholder="Repite la contrasenia" required>
            </div>
        </div>

        <div>
            <label for="fechaNacimiento" class="block mb-2 text-sm font-medium text-yellow-100 flex items-center">
                Fecha de Nacimiento
            </label>
            <input th:field="*{fechaNacimiento}" type="date" id="fechaNacimiento"
                   class="w-full px-4 py-3 rounded-xl bg-white/10 border border-yellow-200/30 text-white placeholder-yellow-200 focus:outline-none focus:ring-2 focus:ring-yellow-400/50 transition duration-200"
                   required max="[[${#temporals.formatDate(#temporals.createToday(), 'yyyy-MM-dd') }]]" min="1900-01-01">
        </div>

        <button id="btn-registrarme" type="submit"
                class="w-full py-3 px-4 bg-yellow-400 text-purple-900 title-font font-semibold rounded-xl hover:bg-yellow-300 focus:ring-2 focus:ring-yellow-500/50 transition duration-200 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                disabled>
            Registrarme
        </button>
    </form>

    <div class="mt-6 text-center">
        <a th:href="@{/login}" class="text-purple-300 hover:text-yellow-300 underline transition duration-200">
            Ya tenes cuenta? <span class="font-semibold">Inicia Sesion</span>
        </a>
    </div>
</div>
</main>

<script>
    const form = document.getElementById('registroForm');
    const btn = document.getElementById('btn-registrarme');
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const fechaInput = document.getElementById('fechaNacimiento');


    // ----------------------------------------------------
    // LÓGICA DE VALIDACIÓN DE CLIENTE Y CONTROL DE BOTÓN
    // ----------------------------------------------------
    function checkForm() {
        // Obtiene todos los inputs required
        const requiredFields = form.querySelectorAll('input[required]');

        // Verifica si todos los required están llenos y valida la fecha no futura
        const allRequiredFilled = Array.from(requiredFields).every(field => {
            if (field.value.trim() === '') return false;

            // Validación de fecha no futura
            if (field === fechaInput) {
                const selectedDate = new Date(field.value);
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                if (selectedDate > today) {
                    // Feedback visual si la fecha es futura
                    field.classList.add('border-red-400', 'ring-2', 'ring-red-400/50');
                    return false;
                } else {
                    field.classList.remove('border-red-400', 'ring-2', 'ring-red-400/50');
                }
            }
            return true; // Campo lleno y (si es fecha) válida
        });

        // Valida longitud mínima de contraseña (8 caracteres)
        const isPasswordLongEnough = passwordInput.value.length >= 8;

        // Valida que las contraseñas coincidan
        const passwordsMatch = passwordInput.value === confirmPasswordInput.value;

        // Feedback visual específico para contraseñas
        if (!passwordsMatch && passwordInput.value !== '' && confirmPasswordInput.value !== '') {
            passwordInput.classList.add('border-red-400', 'ring-2', 'ring-red-400/50');
            confirmPasswordInput.classList.add('border-red-400', 'ring-2', 'ring-red-400/50');
        } else {
            passwordInput.classList.remove('border-red-400', 'ring-2', 'ring-red-400/50');
            confirmPasswordInput.classList.remove('border-red-400', 'ring-2', 'ring-red-400/50');
        }

        // Habilita el botón solo si pasa todas las validaciones
        btn.disabled = !(allRequiredFilled && passwordsMatch && isPasswordLongEnough);

        // Feedback visual: Cambia estilo si disabled
        if (btn.disabled) {
            btn.classList.add('opacity-50', 'cursor-not-allowed');
        } else {
            btn.classList.remove('opacity-50', 'cursor-not-allowed');
        }
    }


    // ----------------------------------------------------
    // INICIALIZACIÓN
    // ----------------------------------------------------

    // Escucha cambios en cualquier input del formulario
    form.addEventListener('input', checkForm);

    // Verificación inicial al cargar la página
    checkForm();
</script>
</body>
</html>