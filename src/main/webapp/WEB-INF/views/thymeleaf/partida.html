<!DOCTYPE HTML>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Partida</title>

    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.2.0/css/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{/css/partida.css}"/>
</head>

<body th:style="|background-image: url('@{/img/{img}(img=${etapa.imagen})}');
                background-size: cover;
                background-position: center;
                background-repeat: no-repeat;|">
<header>
    <nav class="navbar navbar-custom">
        <div class="container-fluid d-flex align-items-center justify-content-between">
            <a class="navbar-brand">
                <img class="logo-escape" th:src="@{/img/Logo.png}" alt="Logo Escape Room">
            </a>

            <h3 class="titulo-sala" th:text="${salaElegida.nombre}"></h3>

            <div class="d-flex align-items-center gap-3" style="font-family: 'Rajdhani', sans-serif;">

                <div id="puntaje" class="puntaje puntaje-container fs-2 fw-bold ">
                    Puntaje: <span class="text-white" id="valor-puntaje" th:text="${partida.puntaje}">0</span>
                    <div id="animacion-puntos" class="animacion-puntos"></div>
                </div>

                <div id="contador-tiempo" class="contador-timer"></div>
            </div>

            <div id="datos-partida"
                 th:data-duracion-minutos="${salaElegida.duracion}"
                 th:data-inicio="${partida.inicio}"
                 hidden>
            </div>
        </div>
    </nav>
</header>
<main>

    <div class="contenedor-partida mt-4">
        <div class="contenedor-etapa-sala">
            <h3 class="nombre-etapa mt-1" th:if="${etapa != null}" th:text="'Etapa: ' + ${etapa.nombre}"></h3>
            <p class="text-muted">Resuelve el siguiente acertijo para pasar a la próxima etapa</p>
        </div>

        <p class="texto-etapa mt-5" th:if="${etapa != null}">
            <span th:text="${#strings.substringBefore(etapa.descripcion, '.')}"></span><br>
            <span th:text="${#strings.substringAfter(etapa.descripcion, '.')}"></span>
        </p>

        <div class="texto-acertijo">
            <div class="acertijo-contenido">
                <div class="acertijo">
                    <p id="texto-acertijo"  th:if="${acertijo != null}" th:text=" ${acertijo.descripcion}"></p>
                </div>
            </div>
        </div>

        <div th:switch="${acertijo.tipo}">

            <div th:case="${T(com.tallerwebi.dominio.enums.TipoAcertijo).DRAG_DROP}">
                <div th:replace="fragmentos/acertijo-dragdrop :: dragdrop"></div>
            </div>

            <div th:case="${T(com.tallerwebi.dominio.enums.TipoAcertijo).ADIVINANZA}">
                <div th:replace="fragmentos/acertijo-adivinanza :: adivinanza"></div>
            </div>

            <div th:case="${T(com.tallerwebi.dominio.enums.TipoAcertijo).ORDENAR_IMAGEN}">
                <div th:replace="fragmentos/acertijo-orden :: ordenar"></div>
            </div>

            <div th:case="${T(com.tallerwebi.dominio.enums.TipoAcertijo).SECUENCIA}">
                <div th:replace="fragmentos/acertijo-secuencia :: secuencia"></div>
            </div>

            <div th:case="*">
                <p>Tipo de acertijo desconocido.</p>
            </div>
        </div>

            <div th:if="${etapa.tieneBonus}" class="zona-secreta" id="zona-secreta"
                 th:style="'top:' + ${etapa.bonusTop} + '%; left:' + ${etapa.bonusLeft} + '%;'">
            </div>

        <div th:if="${error != null}" th:text="${error}" class="text-danger mt-2 text-center"></div>

        <button id="btnPista" class="btn btn-pista rounded-pill mt-3"
                title="Cada pista te restará 25 puntos!"
                th:if="${acertijo != null and acertijo.tipo != T(com.tallerwebi.dominio.enums.TipoAcertijo).SECUENCIA}"
                th:attr="data-acertijo=${acertijo.id}">
            Mostrar pista
        </button>

        <div id="pista" class="mt-3 text-center"></div>
    </div>

    <div class="boton-salir-container">
        <button class="boton-salir" id="btnSalir">Salir</button>
    </div>
</main>

<div id="modalSalir" class="modal">
    <div class="modal-content">
        <p>¿Estás seguro que quieres salir?</p>
        <p>Perderás la partida.</p>
        <div class="modal-buttons">
            <button id="confirmarSalir">Sí, quiero salir</button>
            <button id="cancelarSalir">No, volver</button>
        </div>
    </div>
</div>

<div id="modalBonus" class="modal">
    <div class="modal-content bonus">

            <div class="d-flex flex-column justify-content-center align-items-center mb-4">

                <h2 class="text-success mb-2">Descubriste un bonus!</h2>
                <form th:action="@{/partida/validarBonus/}"
                      method="post" class="w-100 text-center" style="max-width: 600px;">
                    <div class="pos-relative">
                    </div>
                        <div class="input-group rounded-pill overflow-hidden w-100">
                            <input id="input-respuesta" type="text" name="respuesta" class="form-control input-respuesta border-0"
                                   placeholder="Escriba su respuesta aquí">
                            <button id="btn-enviar" type="submit" class="btn btn-enviar">Enviar</button>
                        </div>
                        <button class="btn btn-danger" id="cerrarBonus">Cerrar acertijo bonus</button>

                </form>
            </div>
        </div>
    </div>

<div id="popup-exito" class="popup-exito">¡Correcto! Lo resolviste</div>


<script th:src="@{/js/partida.js}"></script>
<script th:src="@{/js/OrdenarImagenes.js}"></script>
<script th:src="@{/js/contadorPartida.js}"></script>
<script th:src="@{/js/dragDrop.js}"></script>
<script th:src="@{/js/Secuencia.js}"></script>
<script th:src="@{/js/acertijoBonus.js}" charset="UTF-8"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.js"></script>
</body>
</html>
